// dreamland.js, MIT license
const DLFEATURES = ['css', 'jsxLiterals', 'usestring', 'stores']; const DLVERSION = '0.0.25';
!function(e){function t(e,t){}const[n,r,s,i,l,o,f]=Array.from(Array(7),Symbol),a="dlcomponent",c={};function u(){return`${Array(4).fill(0).map(()=>Math.floor(36*Math.random()).toString(36)).join("")}`}const d=e=>function(t,...n){let r="";for(let e of t)r+=e+(n.shift()||"");return m("dl"+u(),r,e)},p=d(!1),h=d(!0);function m(e,t,n){let r=c[t];if(r)return r;c[t]=e;const s=document.createElement("style");document.head.appendChild(s);let i="",l="";for(t+="\n";;){let[e,...n]=t.split("\n");if(e.trim().endsWith("{"))break;if(l+=e+"\n",!(t=n.join("\n")))break}s.textContent=t;let o=!0;if(o=!!window.CSSScopeRule,n&&o){let t="";for(const n of s.sheet.cssRules)n.selectorText||n.media?n.selectorText?.startsWith(":")?(n.selectorText=`.${e}${n.selectorText}`,t+=n.cssText):i+=n.cssText:t+=n.cssText;s.textContent=`.${e} {${l}} @scope (.${e}) to (:not(.${e}).${a} *) { ${i} } ${t}`}else{let t="";n&&!o&&(t=function(e){let t=`:not(${e}).${a}`,n=(r,s)=>`${r} *${s>50?"":`:not(${n(r+" "+(s%2==0?e:t),s+1)})`}`;return`:not(${n(t,0)})`}(`.${e}`));const r=n=>{n.selectorText&&(n.selectorText=n.selectorText.split(",").map(n=>"&"===(n=n.trim())[0]?`.${e}${n.slice(1)}${t}`:":"===n[0]?`.${e}${n}${t}`:`.${e} ${n}${t}`).join(", ")),i+=n.cssText};for(const e of s.sheet.cssRules)e.media&&e.media.mediaText?(i+=`@media(${e.media.mediaText}){`,Array.from(e.cssRules).map(r),i+="}"):r(e);s.textContent=`.${e} {${l}}${i}`}return e}let g=document;const b=Symbol();let y=!1;Object.defineProperty(window,"use",{get:()=>(y=!0,(e,t,...l)=>{if(e instanceof Array)return $(e,t,...l);j(e)||L(e),y=!1;let o={get value(){return function(e){let t=e[s],l=t[i],o=e[n],f=t[r];for(let e of l)if(f=f[e],!S(f))break;for(let e of o)f=e(f);return f}(o)}};if(L(e)){let r=[...e[n]];t&&r.push(t),o[s]=e[s],o[n]=r}else o[s]=e,o[n]=t?[t]:[];return o})}),Object.defineProperty(window,"useChange",{get:()=>(y=!0,(e,n)=>{y=!1,e=e instanceof Array?e:[e];for(let r of e)t(j(r)||L(r)),k(use(r),n)})});const $=(e,...t)=>{y=!1;let n=v({});const r=[];for(const s in e)if(r.push(e[s]),t[s]){let e=t[s];if(j(e)&&(e=use(e)),L(e)){const t=r.length;let s;k(use(e),e=>{r[t]=String(e);let i=r.join("");i!=s&&(n.string=i),s=i})}else r.push(String(e))}return n.string=r.join(""),use(n.string)};let x=new Map;function v(e){S(e),e[l]=[],e[r]=e;let t=Symbol.toPrimitive,o=new Proxy(e,{get(e,l,o){if(y){let f=Symbol(),a=new Proxy({[r]:e,[s]:o,[i]:[l],[t]:()=>f},{get:(e,l)=>[r,s,i,n,t].includes(l)?e[l]:(l=x.get(l)||l,e[i].push(l),a)});return x.set(f,a),a}return Reflect.get(e,l,o)},set(e,t,n){let r=Reflect.set(e,t,n);for(let r of e[l])r(e,t,n);return e[f]&&e[f](e,t,e[t]),r}});return o}let S=e=>e instanceof Object;function w(e){return S(e)&&l in e}function j(e){return S(e)&&i in e}function L(e){return S(e)&&n in e}function T(e){return 0!=e[n].length}function k(e,t){L(e);let o,f=e[s],a=e[n],c=[];function u(){let e=f[r];for(o of c)if(e=e[o],!S(e))break;for(let t of a)e=t(e);t(e)}let d=(e,t)=>function n(s,i,o){if(i===c[t]&&e===s&&(u(),S(o))){let e=o[l];e&&!e.includes(n)&&e.push(d(o[r],t+1))}};for(let e in f[i]){let t=f[i][e];S(t)&&t[r]?k(t,t=>{c[e]=t,u()}):c[e]=t}let p=d(f[r],0);f[r][l].push(p),p(f[r],c[0],f[r][c[0]])}function O(e,t,n){let r,s,i,l;k(e,e=>{i=s?.[0],i&&(r=i.previousSibling||(l=i.parentNode)),s&&s.forEach(e=>e.remove()),s=C(n?e?n.then:n.otherwise:e,e=>{r?(l?(r.prepend(e),l=null):r.after(e),r=e):t(e)})})}let A=e=>t=>{let n=e[s],r=e[i],l=0;for(;l<r.length-1;l++)if(n=n[r[l]],!S(n))return;n[r[l]]=t};function N(e,n,...r){if(e==b)return r;if("function"==typeof e){let i=v(Object.create(e.prototype));for(let e in n){let r=n[e];if(e.startsWith("bind:")){t(L(r)),t(T(r));let l=A(r[s]),o=e.substring(5);if("this"==o)l(i);else{let e=!1;k(r,t=>{e?e=!1:(e=!0,i[o]=t)}),k(use(i[o]),t=>{e?e=!1:(e=!0,l(t))})}delete n[e]}else L(r)&&(k(r,t=>i[e]=t),delete n[e])}Object.assign(i,n),i.children=[];for(let e of r)C(e,i.children.push.bind(i.children));let l=e.apply(i);l.$=i,i.root=l;let o=l.classList,f=i.css,c=e.name.replace(/\$/g,"-");return f&&o.add(m(`${c}-${u()}`,f,!0)),i._leak||o.add(a),l.setAttribute("data-component",e.name),"function"==typeof i.mount&&i.mount(),l}let i=n?.xmlns,l=i?g.createElementNS(i,e):g.createElement(e);for(let e of r){C(e,l.append.bind(l))}if(!n)return l;((e,t)=>{if(!(e in n))return;t(n[e]),delete n[e]})("class",e=>{if("string"==typeof e||e instanceof Array||L(e),"string"!=typeof e){if(L(e)){let t="";return void k(e,e=>{for(let e of t.split(" "))e&&l.classList.remove(e);if("string"==typeof e){for(let t of e.split(" "))t&&l.classList.add(t);t=e}})}for(let t of e)if(L(t)){let e=null;k(t,t=>{"string"==typeof e&&l.classList.remove(e),l.classList.add(t),e=t})}else l.classList.add(t)}else l.setAttribute("class",e)});for(let e in n){let r=n[e];if(e.startsWith("bind:")){t(L(r)),t(T(r));let i=e.substring(5),o=A(r[s]);"this"==i?o(l):"value"==i?(k(r,e=>l.value=e),l.addEventListener("change",()=>o(l.value))):"checked"==i&&(k(r,e=>l.checked=e),l.addEventListener("click",()=>o(l.checked))),delete n[e]}if(e.startsWith("class:")){let t=e.substring(6);L(r)?k(r,e=>{e?l.classList.add(t):l.classList.remove(t)}):r&&l.classList.add(t),delete n[e]}if("style"==e&&S(r)&&!L(r)){for(let e in r){let t=w(r)?use(r[e]):r[e];L(t)?k(t,t=>l.style[e]=t):l.style[e]=t}delete n[e]}}for(let e in n){let t=n[e];L(t)?k(t,t=>{E(l,e,t)}):E(l,e,t)}return i&&(l.innerHTML=l.innerHTML),l}function C(e,t){let n,r,s;if(L(e))O(e,t);else{if(!S(e)||!(o in e)){if(e instanceof Node)return t(e),[e];if(e instanceof Array){for(n of(r=[],e))r=r.concat(C(n,t));return r[0]||(r=C("",t)),r}return null==e&&(e=""),s=g.createTextNode(e),t(s),[s]}O(e[o],t,e)}}function E(e,t,n){if(!n&&e.hasAttribute(t)&&e.removeAttribute(t),n){if(t.startsWith("on:")){let r=t.substring(3);for(let t of r.split("$"))e.addEventListener(t,(...t)=>{self.$el=e,n(...t)});return}e.setAttribute(t,n)}}e.$if=function(e,t,n){return n??=g.createTextNode(""),L(e)?{[o]:e,then:t,otherwise:n}:e?t:n},e.$state=v,e.$store=function(e,{ident:n,backing:s,autosave:i}){let l,o;if("string"==typeof s){if("localstorage"===s)l=()=>localStorage.getItem(n),o=(e,t)=>{localStorage.setItem(e,t)}}else({read:l,write:o}=s);let a=()=>{console.info("[dreamland.js]: saving "+n);let r={},s=0,i=e=>{let n={stateful:w(e),values:{}},l=s++;r[l]=n;for(let r in e){let s=e[r];if(!L(s))switch(typeof s){case"string":case"number":case"boolean":case"undefined":n.values[r]=JSON.stringify(s);break;case"object":if(s instanceof Array){n.values[r]=s.map(e=>"object"==typeof e?i(e):JSON.stringify(e));break}null===s?n.values[r]="null":(t((s.__proto__,Object.prototype)),n.values[r]=i(s))}}return l};i(e);let l=JSON.stringify(r);o(n,l)},c=(e,t,n)=>{w(n)&&(n[r][f]=c),a()},u=JSON.parse(l(n));if(u){let t={},n=e=>{if(t[e])return t[e];let r=u[e],s={};for(let e in r.values){let t=r.values[e];s[e]="string"==typeof t?JSON.parse(t):t instanceof Array?t.map(e=>"string"==typeof e?JSON.parse(e):n(e)):n(t)}r.stateful&&"auto"==i&&(s[f]=c);let l=r.stateful?v(s):s;return t[e]=l,l};e=n(0)}switch(i){case"beforeunload":addEventListener("beforeunload",a);break;case"manual":break;case"auto":e[f]=c}return v(e)},e.Fragment=b,e.css=p,e.h=N,e.html=function(e,...t){e=[...e];let n="",r={};for(let s=0;s<e.length;s++){let i=e[s],l=t[s],o=t[s]instanceof Function&&/^ *\/>/.exec(e[s+1]);if(/< *$/.test(i)&&o&&(e[s+1]=e[s+1].substr(o.index+o[0].length)),n+=i,s<t.length){let e,t=Object.values(r).findIndex(e=>e===l);-1!==t?e=Object.keys(r)[t]:(e="h"+u(),r[e]=l),n+=e,o&&(n+=`></${e}>`)}}let s=(new DOMParser).parseFromString(n,"text/html");return s.body.children.length,function e(t){let n=t.nodeName.toLowerCase();if("#text"===n)return t.textContent;n in r&&(n=r[n]);let s=[...t.childNodes].map(e);for(let e=0;e<s.length;e++){let t=s[e];if("string"==typeof t)for(const[n,i]of Object.entries(r)){if(!t)break;if(!t.includes(n))continue;let r;[r,t]=t.split(n),s=[...s.slice(0,e),r,i,t,...s.slice(e+1)],e+=2}}let i={};if(!t.attributes)return t;for(const e of[...t.attributes]){let t=e.nodeValue;t in r&&(t=r[t]),i[e.name]=t}return N(n,i,s)}(s.body.children[0])},e.isDLPtr=L,e.isStateful=w,e.scope=h}(window)
//# sourceMappingURL=all.js.map
